<mat-card
  class="card-pergunta"
  [class.selected]="isSelected"
  [class.disabled]="isDisabled && !isSelected">

  <!-- CABEÇALHO: Clique no card expande/recolhe -->
  <div class="cabecalho" (click)="toggleExpand()">

    <!-- CONTROLE DE SELEÇÃO (Esquerda) -->
    <div *ngIf="isSelectionMode" class="selection-control" (click)="$event.stopPropagation()">
      <input
        type="checkbox"
        class="custom-checkbox"
        [checked]="isSelected"
        [disabled]="isDisabled && !isSelected"
        (change)="onSelectToggle()"
      />
    </div>

    <div class="titulo-container">
      <h3 class="titulo">{{ pergunta.enunciado }}</h3>
      <span class="prof-label">Prof. {{ pergunta.codigoProfessor | nomeProfessor: professores }}</span>
    </div>

    <!-- Ícone de expansão (Sempre visível agora) -->
    <mat-icon class="icone-expand" [class.rotated]="expanded">expand_more</mat-icon>
  </div>

  <!-- CONTEÚDO EXPANDIDO -->
  <div class="conteudo-expandido" *ngIf="expanded">

    <!-- MODO LEITURA (Geração de Prova) -->
    <div *ngIf="isSelectionMode" class="modo-leitura">
      <p class="label-alternativas">Alternativas:</p>
      <ul class="lista-alternativas-readonly">
        <li *ngFor="let alt of pergunta.alternativas; let i = index">
          <span class="letra">{{ getLetra(i) }})</span> {{ alt.texto }}
        </li>
      </ul>
      <div *ngIf="!pergunta.alternativas.length" class="aviso-vazio">Sem alternativas cadastradas.</div>
    </div>

    <!-- MODO EDIÇÃO (CRUD) -->
    <div *ngIf="!isSelectionMode" class="modo-edicao">
      <div class="alternativas-editaveis">
        <app-cpt-alternativa-forms
          *ngFor="let alt of pergunta.alternativas; let i = index"
          [alternativa]="alt"
          [index]="i"
          (textoChange)="onAlterarTexto($event)"
        ></app-cpt-alternativa-forms>
      </div>

      <!-- Botões de Ação (Apenas CRUD) -->
      <div class="action-buttons">
        <button
          mat-button
          color="primary"
          (click)="onEdit(); $event.stopPropagation()"
        >
          <mat-icon>edit</mat-icon> Editar
        </button>

        <button
          mat-button
          color="warn"
          (click)="onDelete(); $event.stopPropagation()"
        >
          <mat-icon>delete</mat-icon> Excluir
        </button>
      </div>
    </div>

  </div>
</mat-card>
