<mat-card class="card-pergunta" (click)="toggleExpand()">
  <div class="cabecalho">
    <!-- NOVO: Checkbox de Seleção (visível apenas no modo de seleção) -->
    <div *ngIf="isSelectionMode" class="selection-control">
      <input
        type="checkbox"
        [checked]="isSelected"
        [disabled]="isDisabled && !isSelected"
        (change)="onSelectToggle()"
        (click)="$event.stopPropagation()"
      />
    </div>

    <h3 class="titulo">{{ pergunta.enunciado }}</h3>
    <!-- O ícone de expansão só aparece se não estiver no modo de seleção -->
    <mat-icon class="icone" [class.rotated]="expanded" *ngIf="!isSelectionMode">expand_more</mat-icon>
  </div>

  <!-- O conteúdo expandido só aparece se não estiver no modo de seleção -->
  <div class="conteudo-expandido" *ngIf="expanded && !isSelectionMode">
    <div class="alternativas">
      <!-- substituímos o texto direto pelo componente -->
      <app-cpt-alternativa-forms
        *ngFor="let alt of pergunta.alternativas; let i = index"
        [alternativa]="alt"
        [index]="i"
        (textoChange)="onAlterarTexto($event)"
      ></app-cpt-alternativa-forms>
    </div>

    <p class="professor">
      Professor: {{ pergunta.codigoProfessor | nomeProfessor: professores }}
    </p>

    <div class="action-buttons">
      <!-- Botões de ação só aparecem se não estiver no modo de seleção -->
      <button
        mat-icon-button
        color="primary"
        (click)="onEdit(); $event.stopPropagation()"
      >
        <mat-icon>edit</mat-icon>
      </button>

      <button
        mat-icon-button
        color="warn"
        (click)="onDelete(); $event.stopPropagation()"
      >
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
</mat-card>
