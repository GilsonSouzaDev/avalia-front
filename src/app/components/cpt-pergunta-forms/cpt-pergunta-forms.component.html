<div class="form-container">
  <h1 class="form-title">{{ titulo }}</h1>

  <form #questionForm="ngForm" (ngSubmit)="onSubmit(questionForm)" class="question-form">
    <div class="card">
      <!-- Cabeçalho: Disciplina e Quantidade de Alternativas -->
      <div class="header-group">
        <div class="form-group disciplina-group">
          <label for="disciplina">Disciplina</label>

          <!-- MODO CADASTRO: Mostra o Select para escolher -->
          <ng-container *ngIf="!isEdicao">
            <select
              id="disciplina"
              name="disciplina"
              [(ngModel)]="disciplinaId"
              required
              class="form-control"
            >
              <option [ngValue]="null" disabled>Selecione a Disciplina</option>
              <option
                *ngFor="let disciplina of disciplinas"
                [ngValue]="disciplina.id"
              >
                {{ disciplina.nome }}
              </option>
            </select>
            <div
              *ngIf="questionForm.controls['disciplina']?.invalid && questionForm.controls['disciplina']?.touched"
              class="error-message"
            >
              Disciplina é obrigatória.
            </div>
          </ng-container>

          <!-- MODO EDIÇÃO: Mostra apenas o nome da disciplina travado -->
          <ng-container *ngIf="isEdicao">
            <input
              type="text"
              class="form-control"
              [value]="perguntaParaEdicao?.disciplina?.nome || 'Disciplina Indefinida'"
              disabled
              readonly
              style="background-color: #e9ecef; cursor: not-allowed;"
            >
            <small style="color: #6c757d; margin-top: 5px; display: block; font-size: 0.85em;">
              * A disciplina não pode ser alterada durante a edição da pergunta.
            </small>
          </ng-container>

        </div>

        <div class="form-group quantidade-group">
          <label>Quantidade de Alternativas</label>
          <div class="question-count-selector">
            <span
              [class.active]="quantidadeAlternativas === 4"
              (click)="setQuantidadeAlternativas(4)"
            >
              4
            </span>
            <span
              [class.active]="quantidadeAlternativas === 5"
              (click)="setQuantidadeAlternativas(5)"
            >
              5
            </span>
          </div>
        </div>
      </div>

      <!-- Questão (Corpo da Pergunta) -->
      <div class="form-group">
        <label for="enunciado">Questão</label>
        <textarea
          id="enunciado"
          name="enunciado"
          [(ngModel)]="enunciado"
          required
          class="form-control question-textarea"
          rows="5"
          placeholder="Digite o enunciado da questão..."
        ></textarea>
        <div
          *ngIf="questionForm.controls['enunciado']?.invalid && questionForm.controls['enunciado']?.touched"
          class="error-message"
        >
          O texto da questão é obrigatório.
        </div>
      </div>

      <!-- Alternativas -->
      <div class="form-group">
        <label>Alternativas</label>
        <div class="alternativas-list">
          <div *ngFor="let alternativa of alternativas; let i = index" class="alternativa-item">
            <ng-container *ngIf="i < quantidadeAlternativas">
              <input
                type="text"
                name="alternativa-{{i}}"
                [(ngModel)]="alternativa.texto"
                required
                class="form-control alternativa-input"
                placeholder="Texto da alternativa"
              >
              <div
                *ngIf="questionForm.controls['alternativa-' + i]?.invalid && questionForm.controls['alternativa-' + i]?.touched"
                class="error-message"
              >
                O texto da alternativa é obrigatório.
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- Botão de Ação -->
    <div class="action-row">
      <button type="submit" [disabled]="questionForm.invalid" class="submit-btn">
        {{ textoBotao }}
      </button>
    </div>
  </form>
</div>
