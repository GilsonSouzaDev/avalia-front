<div class="form-container">
  <h3>{{ editando ? 'Atualizar' : 'Cadastrar' }}</h3>

  <form #profForm="ngForm" (ngSubmit)="onSubmit(profForm)">

    <div class="campo">
      <label for="nome">Nome</label>
      <input
        type="text"
        id="nome"
        name="nome"
        [(ngModel)]="nome"
        required
        #nomeCtrl="ngModel"
        appNomeUnico
        [ignorarId]="professorAtivo?.id"
      />
      <div *ngIf="nomeCtrl.invalid && (nomeCtrl.dirty || nomeCtrl.touched)" class="erro-msg">
        <small *ngIf="nomeCtrl.errors?.['required']">Nome é obrigatório.</small>
        <small *ngIf="nomeCtrl.errors?.['nomeExistente']" style="color: red;">Este nome já está cadastrado.</small>
      </div>
    </div>

    <div class="campo">
      <label for="email">Email</label>
      <input
        type="email"
        id="email"
        name="email"
        [(ngModel)]="email"
        required
        email
        #emailCtrl="ngModel"
        appEmailUnico
        [ignorarId]="professorAtivo?.id"
      />
      <div *ngIf="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)" class="erro-msg">
        <small *ngIf="emailCtrl.errors?.['required']">Email é obrigatório.</small>
        <small *ngIf="emailCtrl.errors?.['email']">Formato de email inválido.</small>
        <small *ngIf="emailCtrl.errors?.['emailExistente']" style="color: red;">Este email já está cadastrado.</small>
      </div>
    </div>

    <div class="campo">
      <label for="senha">{{ editando ? 'Nova Senha (Opcional)' : 'Senha' }}</label>

      <div class="input-wrapper">
        <input
          [type]="ocultarSenha ? 'password' : 'text'"
          id="senha"
          name="senha"
          [(ngModel)]="senha"
          (input)="validarSenhas()"
          [required]="!editando"
          placeholder="Digite a senha"
        />
        <button
          type="button"
          class="btn-eye"
          (click)="ocultarSenha = !ocultarSenha"
          tabindex="-1">
          <mat-icon>{{ ocultarSenha ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
      </div>
    </div>

    <div class="campo" *ngIf="senha">
      <label for="confirmarSenha">Confirmar Senha</label>

      <div class="input-wrapper">
        <input
          [type]="ocultarConfirmacao ? 'password' : 'text'"
          id="confirmarSenha"
          name="confirmarSenha"
          [(ngModel)]="confirmarSenha"
          (input)="validarSenhas()"
          [required]="!editando"
          placeholder="Confirme a senha"
        />
        <button
          type="button"
          class="btn-eye"
          (click)="ocultarConfirmacao = !ocultarConfirmacao"
          tabindex="-1">
          <mat-icon>{{ ocultarConfirmacao ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
      </div>

      <div *ngIf="erroSenha" class="erro-senha">{{ erroSenha }}</div>
    </div>

    <div class="campo" *ngIf="mostrarDisciplinas">
      <label>Disciplinas</label>
      <div class="disciplinas-grid">
        <label
          *ngFor="let d of disciplinasDisponiveis()"
          class="disciplina-item"
        >
          <input
            type="checkbox"
            [checked]="isDisciplinaSelecionada(d)"
            (change)="onDisciplinaChange($event, d)"
          />
          {{ d.nome }}
        </label>
      </div>
    </div>

    <div class="form-actions">
      <button
        type="submit"
        class="btn-cadastrar"
        [disabled]="profForm.invalid || erroSenha"
      >
        {{ editando ? 'Atualizar' : 'Cadastrar' }}
      </button>

      <button
        type="button"
        class="btn-cancelar"
        (click)="cancelarCadastro()"
      >
        Cancelar
      </button>
    </div>
  </form>
</div>
